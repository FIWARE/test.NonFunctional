This project is part of FIWARE and has been made in collaboration with the TM Forum.

# APInf/API Umbrella: non functional test guidelines

APInf/API Umbrella is an open source API management platform for exposing web service APIs. The basic goal of API Umbrella is to make life easier for both API creators and API consumers. How?

* **Make life easier for API creators:** Allow API creators to focus on building APIs.
  * **Standardize the boring stuff:** APIs can assume the boring stuff (access control, rate limiting, analytics, etc.) is already taken care if the API is being accessed, so common functionality doesn't need to be implemented in the API code.
  * **Easy to add:** API Umbrella acts as a layer above your APIs, so your API code doesn't need to be modified to take advantage of the features provided.
  * **Scalability:** Make it easier to scale your APIs.
* **Make life easier for API consumers:** Let API consumers easily explore and use your APIs.
  * **Unify disparate APIs:** Present separate APIs as a cohesive offering to API consumers. APIs running on different servers or written in different programming languages can be exposed at a single endpoint for the API consumer.
  * **Standardize access:** All your APIs are can be accessed using the same API key credentials.
  * **Standardize documentation:** All your APIs are documented in a single place and in a similar fashion.
  

## Testing environment

For the testing environment, is needed:

A machine for the deployment of the GEri to be tested, APInf/API Umbrella. We recommend to use the Docker compilation, where you can find everything necessary to run this environment.

A machine for JMeter, the tool used to inject load and for simulating the client and collecting the results generated by APInf/API Umbrella.

## Test execution 

### Preliminary setup 

Once the HW necessary for the test described previously at "Testing Environmment" chapter have been setup, the following preliminary steps need to be accomplished before to start the test process: In order to do the installation of APInf/API Umbrella, a Docker instance is needed.

## Testing step by step 

The test of APInf/API Umbrella must be done in two steps:

*Script configuration:*

Depending on the scenario to execute (stress, stability), number of threads, ramp-up and test duration must be configured. Host IP and Port must be configured too. For this purpose, the following User Defined variables in the Jmeter scripts (Stability_API_Umbrella.jmx, Stress_API_Umbrella.jmx) must be configured:

* HOST -> IP or hostname of the host where APInf/API Umbrella is deployed.
* PORT -> Port where APInf/API Umbrella is listening.
* api_key -> Key obtained after API is registered on API Umbrella system.

Furthermore, the number of threads, the ramp up and the test duration must be configured. It is recommended to use the planificator from the threads group. The duration for the stress tests was 25 minutes, and 6 hours in the stability case.

Finally, in order to get the results, the path to the results file must be configured in the Simple Data Writer from the script.

*Script execution:*

For executing the script, the following command must be typed in the jmeter bin folder:

`./jmeter.sh -n -t /path/to/script/scriptName.jmx`

It´s recommended to execute the command in background and nohup mode:

`nohup ./jmeter.sh -n -t /path/to/script/scriptName.jmx &`

It´s highly recommended to use a hardware resources monitoring tool, in order to measure things like memory and CPU usages, free memory, etc.

## Expected results

As output from the script, a .dat file (in csv format) is generated. This file can be used for plotting different kinds of charts, like threads number, response times, number of errores, responses per second, etc. A plotting tool (like gnuplot) is needed in order to do this.

Additionally, if a monitoring tool has been used, then different data from it is collected too. Depending on the monitoring tool, it can generate charts directly, or it can be used another tool for plotting the output from monitoring tool (for example, sar from systat library can be used for monitoring, and k-sar tool for plotting the sar output)
